<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Layanan LVPD</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(135deg,#1e3c72,#2a5298);
      background-size: 400% 400%;
      animation: gradientMove 15s ease infinite;
      color: #fff;
      min-height: 100vh;
    }
    @keyframes gradientMove {
      0% { background-position:0% 50% }
      50% { background-position:100% 50% }
      100% { background-position:0% 50% }
    }
    .center {
      display:flex; justify-content:center; align-items:center;
      height:100vh; text-align:center;
    }
    .login-card {
      background:rgba(0,0,0,0.75);
      padding:40px; border-radius:15px;
      width:320px; box-shadow:0 10px 25px rgba(0,0,0,0.6);
    }
    .login-card h1 {margin-bottom:20px;font-size:1.8rem;}
    .discord-btn {
      display:inline-block;
      background:#5865F2; color:white;
      padding:12px 20px; border-radius:8px;
      font-weight:bold; text-decoration:none;
      transition:background 0.3s;
    }
    .discord-btn:hover {background:#4752c4;}
    .dashboard {
      padding:20px;
    }
    .user-info {
      display:flex; align-items:center;
      gap:10px; margin-bottom:20px;
    }
    .user-info img {
      width:40px; height:40px;
      border-radius:50%;
    }
    .grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
      gap:20px;
    }
    .card {
      background:rgba(0,0,0,0.6);
      padding:20px;
      border-radius:12px;
      box-shadow:0 6px 15px rgba(0,0,0,0.5);
      transition:transform .2s;
    }
    .card:hover {transform:scale(1.03);}
    .card h2 {margin-top:0;font-size:1.2rem;}
    input, textarea, button {
      width:100%; padding:10px;
      margin-top:8px; border:none; border-radius:6px;
    }
    button {
      background:#5865F2; color:white; font-weight:bold;
      cursor:pointer; transition:background 0.3s;
    }
    button:hover {background:#4752c4;}
  </style>
</head>
<body>
  <!-- LOGIN -->
  <div id="loginPage" class="center">
    <div class="login-card">
      <h1>Login Layanan LVPD</h1>
      <p>Masuk dengan akun Discord Anda</p>
      <a class="discord-btn" 
         id="discordLogin"
         href="https://discord.com/api/oauth2/authorize?client_id=1423706389531856976&redirect_uri=https%3A%2F%2Flayanan-lvpd.vercel.app%2F&response_type=token&scope=identify">
         Login dengan Discord
      </a>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" style="display:none;" class="dashboard">
    <div class="user-info">
      <img id="userAvatar" src="" alt="avatar"/>
      <span id="userName"></span>
    </div>
    <h1>Pilih Layanan Kepolisian</h1>
    <div class="grid">
      <div class="card">
        <h2>Pengajuan SKCK</h2>
        <form class="formService">
          <input type="text" name="nama" placeholder="Nama Lengkap" required>
          <textarea name="keterangan" placeholder="Tujuan SKCK" required></textarea>
          <button type="submit">Kirim</button>
        </form>
      </div>
      <div class="card">
        <h2>Pembuatan SIM</h2>
        <form class="formService">
          <input type="text" name="nama" placeholder="Nama Lengkap" required>
          <textarea name="keterangan" placeholder="Jenis SIM (A, C, dll)" required></textarea>
          <button type="submit">Kirim</button>
        </form>
      </div>
      <div class="card">
        <h2>STNK / BPKB</h2>
        <form class="formService">
          <input type="text" name="nama" placeholder="Nama Lengkap" required>
          <textarea name="keterangan" placeholder="Jenis Pengurusan STNK/BPKB" required></textarea>
          <button type="submit">Kirim</button>
        </form>
      </div>
      <div class="card">
        <h2>Laporan Kehilangan</h2>
        <form class="formService">
          <input type="text" name="nama" placeholder="Nama Lengkap" required>
          <textarea name="keterangan" placeholder="Barang / Dokumen yang Hilang" required></textarea>
          <button type="submit">Kirim</button>
        </form>
      </div>
      <div class="card">
        <h2>Izin Keramaian</h2>
        <form class="formService">
          <input type="text" name="nama" placeholder="Nama Penanggung Jawab" required>
          <textarea name="keterangan" placeholder="Acara yang diselenggarakan" required></textarea>
          <button type="submit">Kirim</button>
        </form>
      </div>
      <div class="card">
        <h2>Laporan Kriminal</h2>
        <form class="formService">
          <input type="text" name="nama" placeholder="Nama Pelapor" required>
          <textarea name="keterangan" placeholder="Detail Laporan Kriminal" required></textarea>
          <button type="submit">Kirim</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Tangkap token setelah login Discord
    const hash = window.location.hash;
    if (hash.includes("access_token")) {
      const params = new URLSearchParams(hash.replace("#","?"));
      const token = params.get("access_token");

      // Ambil data user Discord
      fetch("https://discord.com/api/users/@me", {
        headers: { Authorization: `Bearer ${token}` }
      })
      .then(res => res.json())
      .then(user => {
        document.getElementById("loginPage").style.display="none";
        document.getElementById("dashboard").style.display="block";
        document.getElementById("userName").innerText = user.username+"#"+user.discriminator;
        document.getElementById("userAvatar").src =
          `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;
      });
    }

    // Kirim form ke Discord Webhook
    const WEBHOOK_URL = "MASUKKAN_WEBHOOK_DISCORD_KAMU";
    document.querySelectorAll(".formService").forEach(form=>{
      form.addEventListener("submit", e=>{
        e.preventDefault();
        const data = new FormData(form);
        const payload = {
          content: `**Layanan ${form.parentElement.querySelector("h2").innerText}**
Nama: ${data.get("nama")}
Keterangan: ${data.get("keterangan")}`
        };
        fetch(WEBHOOK_URL, {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify(payload)
        }).then(()=>{
          alert("Permohonan berhasil dikirim!");
          form.reset();
        });
      });
    });
  </script>
</body>
</html>
