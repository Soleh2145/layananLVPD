<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Layanan Kepolisian</title>
  <style>
    *{box-sizing:border-box;}
    body{margin:0;font-family:'Segoe UI',sans-serif;color:#fff;background:#0b1220;overflow-x:hidden;}
    body::before{
      content:"";position:fixed;top:0;left:0;width:200%;height:200%;
      background:linear-gradient(-45deg,#0ea5a4,#06b6d4,#1e3a8a,#111827);
      background-size:400% 400%;animation:bgmove 20s ease infinite;z-index:-1;
    }
    @keyframes bgmove{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}

    .hidden{display:none;}
    .center{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px;}
    .card{background:rgba(15,23,36,0.85);backdrop-filter:blur(12px);
      padding:30px;border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.6);width:350px;text-align:center;}
    h2{text-align:center;margin:0 0 20px;color:#06b6d4}
    label{display:block;margin:12px 0 6px;}
    input,select,textarea{width:100%;padding:10px;border:none;border-radius:8px;background:#1e293b;color:#fff;}
    button{margin-top:15px;width:100%;padding:12px;border:none;border-radius:8px;
      background:linear-gradient(90deg,#06b6d4,#0ea5a4);font-weight:bold;color:#000;cursor:pointer;transition:.3s}
    button:hover{opacity:.9}

    nav{background:rgba(15,23,36,.9);backdrop-filter:blur(10px);padding:15px 25px;
      display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:10;}
    nav h1{margin:0;font-size:1.3rem;color:#06b6d4;}
    nav .user-info{display:flex;align-items:center;gap:10px;}
    nav img{border-radius:50%;width:32px;height:32px}

    .container{padding:30px;display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;}
    .service{background:rgba(15,23,36,0.8);padding:20px;border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,.5);
      transition:.3s;display:flex;flex-direction:column;}
    .service:hover{transform:translateY(-6px);box-shadow:0 10px 25px rgba(0,0,0,.7);}
    .service h3{margin:0 0 10px;color:#06b6d4}

    .admin-panel{grid-column:1/-1;background:rgba(220,38,38,0.1);border:1px solid #dc2626;
      padding:20px;border-radius:14px;}
    .admin-panel h3{color:#f87171;margin-top:0}

    .toast{position:fixed;bottom:20px;right:-400px;background:#06b6d4;color:#000;
      padding:14px 22px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.5);
      transition:all .5s ease;font-weight:600;}
    .toast.show{right:20px;}
  </style>
</head>
<body>

<!-- LOGIN DISCORD -->
<div id="loginPage" class="center">
  <div class="card">
    <h2>Layanan Kepolisian</h2>
    <p>Silakan login dengan akun Discord Anda</p>
    <button onclick="loginDiscord()">Login dengan Discord</button>
  </div>
</div>

<!-- APP -->
<div id="appPage" class="hidden">
  <nav>
    <h1>Layanan Kepolisian</h1>
    <div class="user-info">
      <img id="avatar" src="">
      <span id="welcomeUser"></span>
      <button onclick="logout()" style="background:#f43f5e;color:#fff;width:auto;padding:8px 16px;border-radius:8px;">Logout</button>
    </div>
  </nav>
  <div class="container">
    <!-- SKCK -->
    <div class="service">
      <h3>SKCK</h3>
      <form onsubmit="return sendForm(event,'SKCK')">
        <label>Nama</label><input type="text" name="nama" required>
        <label>Keperluan</label><input type="text" name="keperluan" required>
        <button type="submit">Ajukan</button>
      </form>
    </div>
    <!-- SIM -->
    <div class="service">
      <h3>Penerbitan SIM</h3>
      <form onsubmit="return sendForm(event,'SIM')">
        <label>Nama</label><input type="text" name="nama" required>
        <label>Jenis SIM</label>
        <select name="jenis"><option>A</option><option>C</option><option>B1</option><option>B2</option></select>
        <button type="submit">Ajukan</button>
      </form>
    </div>
    <!-- STNK / BPKB -->
    <div class="service">
      <h3>STNK / BPKB</h3>
      <form onsubmit="return sendForm(event,'STNK-BPKB')">
        <label>Nama</label><input type="text" name="nama" required>
        <label>Jenis Layanan</label>
        <select name="jenis"><option>Perpanjangan STNK</option><option>Penerbitan BPKB</option></select>
        <button type="submit">Ajukan</button>
      </form>
    </div>
    <!-- Laporan Kehilangan -->
    <div class="service">
      <h3>Laporan Kehilangan</h3>
      <form onsubmit="return sendForm(event,'Laporan Kehilangan')">
        <label>Nama</label><input type="text" name="nama" required>
        <label>Barang Hilang</label><input type="text" name="barang" required>
        <label>Kronologi</label><textarea name="detail" required></textarea>
        <button type="submit">Laporkan</button>
      </form>
    </div>
    <!-- Izin Keramaian -->
    <div class="service">
      <h3>Izin Keramaian</h3>
      <form onsubmit="return sendForm(event,'Izin Keramaian')">
        <label>Pemohon</label><input type="text" name="nama" required>
        <label>Lokasi Acara</label><input type="text" name="lokasi" required>
        <label>Jumlah Peserta</label><input type="number" name="peserta" required>
        <button type="submit">Ajukan</button>
      </form>
    </div>
    <!-- Laporan Kriminal -->
    <div class="service">
      <h3>Laporan Kriminal</h3>
      <form onsubmit="return sendForm(event,'Laporan Kriminal')">
        <label>Pelapor</label><input type="text" name="nama" required>
        <label>Jenis Laporan</label><input type="text" name="jenis" required>
        <label>Detail Kejadian</label><textarea name="detail" required></textarea>
        <button type="submit">Laporkan</button>
      </form>
    </div>

    <!-- ADMIN PANEL -->
    <div id="adminPanel" class="admin-panel hidden">
      <h3>Panel Admin</h3>
      <p>Selamat datang di dashboard admin.</p>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
  // === SETUP DISCORD OAUTH2 ===
  const CLIENT_ID = "https://discord.com/api/oauth2/authorize?client_id=1423706389531856976&redirect_uri=REDIRECT_URL&response_type=token&scope=identify";
  const REDIRECT_URI = "https://layanan-lvpd.vercel.app/"; // ganti dengan domain vercel kamu
  const SCOPE = "identify";
  const WEBHOOK_URL="https://discord.com/api/webhooks/1312393500846850098/PJos5JTVjPyvEs21JDn05p6KRCmoGTorII3NN54F35xZr3fC98ajr3rhoUrQ07K8RAew"; // ganti webhook discord

  // contoh ID admin Discord
  const ADMIN_IDS = ["123456789012345678"];

  function loginDiscord(){
    const url = `https://discord.com/api/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=${SCOPE}`;
    window.location.href = url;
  }

  // === CEK CALLBACK ===
  window.onload = () => {
    if(window.location.hash){
      const params = new URLSearchParams(window.location.hash.substring(1));
      const token = params.get("access_token");
      if(token){
        fetch("https://discord.com/api/users/@me", {
          headers:{Authorization:`Bearer ${token}`}
        })
        .then(r=>r.json())
        .then(user=>{
          localStorage.setItem("discordUser", JSON.stringify(user));
          showApp(user);
        });
      }
    } else {
      const saved=localStorage.getItem("discordUser");
      if(saved) showApp(JSON.parse(saved));
    }
  }

  function showApp(user){
    document.getElementById("loginPage").classList.add("hidden");
    document.getElementById("appPage").classList.remove("hidden");
    document.getElementById("welcomeUser").innerText=user.username+"#"+user.discriminator;
    document.getElementById("avatar").src=`https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;
    if(ADMIN_IDS.includes(user.id)) document.getElementById("adminPanel").classList.remove("hidden");
  }

  function logout(){
    localStorage.removeItem("discordUser");
    window.location.href = REDIRECT_URI;
  }

  async function sendForm(e,jenis){
    e.preventDefault();
    const form=e.target;const data=new FormData(form);
    let msg="**"+jenis+"**\n";for(const[k,v]of data.entries()){msg+=`• ${k}: ${v}\n`;}
    try{await fetch(WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:msg})});
      showToast("✅ "+jenis+" terkirim!");form.reset();}
    catch(err){showToast("❌ Gagal mengirim!");}
    return false;
  }
  function showToast(msg){
    const t=document.getElementById("toast");t.innerText=msg;t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"),3000);
  }
</script>
</body>
</html>
